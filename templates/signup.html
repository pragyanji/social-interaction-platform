{% extends "base.html" %}
{% load static %}
{% load socialaccount %}

{% block title %}Create Account ¬∑ ChatSphere{% endblock %}

{% block head_extra %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/auth.css' %}" />
{% endblock %}

{% block content %}

<!-- Particle canvas -->
<canvas id="auth-canvas"></canvas>

<div class="auth-container">
  <div class="auth-grid">
    <div class="auth-form-wrapper">
      <form method="post" action="{% url 'signup' %}" class="auth-form" enctype="multipart/form-data">

        <div>
          <h2>Join ChatSphere</h2>
          <p class="auth-form-subtitle">Create your free account and start connecting</p>
        </div>

        {% csrf_token %}

        {% if form and form.non_field_errors %}
          <div class="form-errors">
            {% for e in form.non_field_errors %}<p>{{ e }}</p>{% endfor %}
          </div>
        {% endif %}

        <!-- Username -->
        <div class="auth-field">
          <label for="id_username">Username <span class="auth-required">*</span></label>
          <input id="id_username" name="username" type="text"
             value="{{ form.username.value|default_if_none:''}}"
             placeholder="Choose a unique username"
             autocomplete="username"
             required />
          {% if form and form.username.errors %}
            <small class="error-text">{% for e in form.username.errors %}{{ e }}{% if not forloop.last %}<br>{% endif %}{% endfor %}</small>
          {% endif %}
        </div>

        <!-- Full Name -->
        <div class="auth-field">
          <label for="id_full_name">Full Name <span class="auth-required">*</span></label>
          <input id="id_full_name" name="full_name" type="text"
             value="{{ form.full_name.value|default_if_none:''}}"
             placeholder="Your full name"
             autocomplete="name"
             required />
        </div>

        <!-- Email -->
        <div class="auth-field">
          <label for="id_email">Email</label>
          <input id="id_email" name="email" type="email"
             value="{{ form.email.value|default_if_none:''}}"
             placeholder="your@email.com"
             autocomplete="email" />
          {% if form and form.email.errors %}
            <small class="error-text">{% for e in form.email.errors %}{{ e }}{% if not forloop.last %}<br>{% endif %}{% endfor %}</small>
          {% endif %}
        </div>

        <!-- Password -->
        <div class="auth-field">
          <label for="id_password1">Password <span class="auth-required">*</span></label>
          <input id="id_password1" name="password1" type="password"
             placeholder="Create a strong password"
             autocomplete="new-password"
             required />
          <p class="field-hint">At least 8 characters ¬∑ mix of numbers & letters ¬∑ avoid common words</p>
        </div>

        <!-- Confirm Password -->
        <div class="auth-field">
          <label for="id_password2">Confirm Password <span class="auth-required">*</span></label>
          <input id="id_password2" name="password2" type="password"
             placeholder="Re-enter your password"
             autocomplete="new-password"
             required />
          {% if form and form.password2.errors %}
            <small class="error-text">{% for e in form.password2.errors %}{{ e }}{% if not forloop.last %}<br>{% endif %}{% endfor %}</small>
          {% endif %}
        </div>

        <button type="submit" class="auth-submit-btn" id="signup-submit-btn">Create Account</button>

        <div class="auth-divider"><div class="auth-divider-text">or</div></div>

        <a class="google-btn" href="{% provider_login_url 'google' %}" id="google-signup-btn">
          <span>üîê</span>
          <span>Continue with Google</span>
        </a>

        <p class="auth-signin-link">
          Already have an account? <a href="{% url 'signin' %}">Sign in ‚Üí</a>
        </p>

      </form>
    </div>
  </div>
</div>

<script>
(function () {
  const canvas = document.getElementById('auth-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
  resize(); window.addEventListener('resize', resize);

  class Particle {
    constructor() { this.reset(); }
    reset() {
      this.x = Math.random() * canvas.width; this.y = Math.random() * canvas.height;
      this.r = Math.random() * 1.6 + 0.3; this.alpha = Math.random() * 0.4 + 0.08;
      this.dx = (Math.random() - 0.5) * 0.28; this.dy = (Math.random() - 0.5) * 0.28;
    }
    update() {
      this.x += this.dx; this.y += this.dy;
      if (this.x < 0 || this.x > canvas.width || this.y < 0 || this.y > canvas.height) this.reset();
    }
    draw() {
      ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(167,139,250,${this.alpha})`; ctx.fill();
    }
  }

  for (let i = 0; i < 150; i++) particles.push(new Particle());
  function loop() { ctx.clearRect(0, 0, canvas.width, canvas.height); particles.forEach(p => { p.update(); p.draw(); }); requestAnimationFrame(loop); }
  loop();
})();
</script>
{% endblock %}
