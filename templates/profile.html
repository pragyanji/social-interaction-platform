{% extends "base.html" %}
{% load static %}
{% block title %}{{ user.username }} · ChatSphere{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}" />
{% endblock %}

{% block content %}
<div class="prof-wrap">

  <!-- ── Cover + Identity card ── -->
  <div class="prof-cover">
    <div class="cover-bg"></div>
    <div class="prof-identity">
      <div class="prof-avatar-ring">
        {% if user.profile_pic %}
          <img src="{{ user.profile_pic.url }}" alt="{{ user.username }}" class="prof-avatar" />
        {% else %}
          <img src="{% static 'img/default_profile.png' %}" alt="Avatar" class="prof-avatar" />
        {% endif %}
      </div>
      <div class="prof-meta">
        <h1 class="prof-fullname">{{ user.full_name|default:user.username }}</h1>
        <p class="prof-handle">@{{ user.username }}</p>
        {% if user.email %}<p class="prof-email"><i class="fas fa-envelope"></i> {{ user.email }}</p>{% endif %}
        <p class="prof-since"><i class="fas fa-calendar-alt"></i> Member since {{ user.date_joined|date:"F Y" }}</p>
      </div>
      <a href="{% url 'edit_profile' %}" class="prof-edit-btn">
        <i class="fas fa-pen"></i> Edit Profile
      </a>
    </div>
  </div>

  <!-- ── Stat Ribbon ── -->
  <div class="stat-ribbon">
    <div class="ribbon-stat">
      <span class="rs-icon" style="color:#a78bfa;"><i class="fas fa-star-half-stroke"></i></span>
      <span class="rs-val">{{ aura_points }}</span>
      <span class="rs-lbl">Aura</span>
    </div>
    <div class="ribbon-divider"></div>
    <div class="ribbon-stat">
      <span class="rs-icon" style="color:#fbbf24;"><i class="fas fa-star"></i></span>
      <span class="rs-val">{{ avg_rating|floatformat:1 }}</span>
      <span class="rs-lbl">Avg Rating<span class="rs-sub">({{ total_ratings }})</span></span>
    </div>
    <div class="ribbon-divider"></div>
    <div class="ribbon-stat">
      <span class="rs-icon" style="color:#34d399;"><i class="fas fa-user-group"></i></span>
      <span class="rs-val">{{ total_connections }}</span>
      <span class="rs-lbl">Connections</span>
    </div>
    <div class="ribbon-divider"></div>
    <div class="ribbon-stat">
      <span class="rs-icon" style="color:#fb923c;"><i class="fas fa-fire"></i></span>
      <span class="rs-val">{{ streak_days }}</span>
      <span class="rs-lbl">Streak<span class="rs-sub">best {{ longest_streak }}</span></span>
    </div>
  </div>

  <!-- ── Connections roster ── -->
  {% if user_connections %}
  <section class="prof-section">
    <div class="prof-section-head">
      <h2><i class="fas fa-user-group"></i> Connections</h2>
      <a href="{% url 'connections' %}" class="view-all-link">View all <i class="fas fa-arrow-right"></i></a>
    </div>
    <div class="roster-grid">
      {% for conn in user_connections %}
      <div class="roster-card">
        <div class="roster-avatar">
          {% if conn.profile_pic %}
            <img src="{{ conn.profile_pic.url }}" alt="{{ conn.username }}" />
          {% else %}
            <img src="{% static 'img/default_profile.png' %}" alt="Avatar" />
          {% endif %}
        </div>
        <p class="roster-name">{{ conn.full_name|default:conn.username }}</p>
        <p class="roster-handle">@{{ conn.username }}</p>
        <a href="{% url 'startmessagechat' conn.id %}" class="roster-msg-btn" title="Message">
          <i class="fas fa-message"></i>
        </a>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- ── Account Settings panel ── -->
  <section class="prof-section">
    <div class="prof-section-head">
      <h2><i class="fas fa-id-card"></i> Account Info</h2>
      <a href="{% url 'edit_profile' %}" class="view-all-link"><i class="fas fa-pen"></i> Edit</a>
    </div>
    <div class="settings-panel">
      <div class="settings-row">
        <span class="setting-icon"><i class="fas fa-at"></i></span>
        <div class="setting-body">
          <span class="setting-lbl">Username</span>
          <span class="setting-val">{{ user.username }}</span>
        </div>
      </div>
      <div class="settings-row">
        <span class="setting-icon"><i class="fas fa-user"></i></span>
        <div class="setting-body">
          <span class="setting-lbl">Full Name</span>
          <span class="setting-val">{{ user.full_name|default:"Not set" }}</span>
        </div>
      </div>
      <div class="settings-row">
        <span class="setting-icon"><i class="fas fa-envelope"></i></span>
        <div class="setting-body">
          <span class="setting-lbl">Email</span>
          <span class="setting-val">{{ user.email|default:"Not set" }}</span>
        </div>
      </div>
      <div class="settings-row">
        <span class="setting-icon"><i class="fas fa-calendar"></i></span>
        <div class="setting-body">
          <span class="setting-lbl">Joined</span>
          <span class="setting-val">{{ user.date_joined|date:"F d, Y" }}</span>
        </div>
      </div>
    </div>
  </section>

  <!-- ── Footer actions ── -->
  <div class="prof-footer-actions">
    <a href="{% url 'home' %}" class="pfa-ghost"><i class="fas fa-house"></i> Dashboard</a>
    <a href="{% url 'change_password' %}" class="pfa-ghost"><i class="fas fa-lock"></i> Change Password</a>
    <a href="{% url 'startvideochat' %}" class="pfa-primary"><i class="fas fa-video"></i> Start Video Chat</a>
  </div>

</div>
{% endblock %}