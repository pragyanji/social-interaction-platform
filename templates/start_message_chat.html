{% extends "base.html" %}
{% load static %}
{% block title %}Message Chat Â· Chatsphere{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{% static 'css/messages.css' %}" />
{% endblock %}

{% block content %}
<h2 class="page-title">Message</h2>
{% if request.user.is_authenticated %}
    <div class="messages-container">
        <!-- Connected Users List -->
        <div class="card">
            <h3>Your Connections</h3>
            {% if connected_users %}
                <div class="users-list">
                    {% for user in connected_users %}
                        <div class="user-item {% if selected_user.id == user.id %}active{% endif %}">
                            <div class="user-info">
                                <a href="{% url 'startmessagechat' user.id %}" class="user-info-link">
                                    {% if user.profile_pic %}
                                        <img src="{{ user.profile_pic.url }}" alt="{{ user.get_username }}" class="user-avatar" />
                                    {% else %}
                                        <img src="{% static 'img/default_profile.png' %}" alt="Profile" class="user-avatar" />
                                    {% endif %}
                                    <div class="user-details">
                                        <p class="user-name">{{ user.full_name }}</p>
                                        <p class="user-username">@{{ user.username }}</p>
                                    </div>
                                </a>
                            </div>
                            <a href="{% url 'startmessagechat' user.id %}" class="user-chat-btn">Chat</a>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="connections-empty">
                    You don't have any connections yet.<br><br>
                    <a href="{% url 'connections' %}">Add connections</a> to start messaging.
                </p>
            {% endif %}
        </div>

        <!-- Chat Area -->
        <div class="card chat-container">
            {% if selected_user %}
                <div class="chat-header">
                    {% if selected_user.profile_pic %}
                        <img src="{{ selected_user.profile_pic.url }}" alt="{{ selected_user.get_username }}" class="chat-header-avatar" />
                    {% else %}
                        <img src="{% static 'img/default_profile.png' %}" alt="Profile" class="chat-header-avatar" />
                    {% endif %}
                    <div class="chat-header-info">
                        <h3>{{ selected_user.full_name }}</h3>
                        <p class="chat-header-username">@{{ selected_user.username }}</p>
                    </div>
                </div>
                <div class="chat-messages">
                    <p>ðŸ’¬ Chat functionality coming soon...</p>
                </div>
                <div class="message-input-area">
                    <input type="text" class="message-input" placeholder="Type your message...">
                    <button class="message-send-btn">Send</button>
                </div>
            {% else %}
                <div class="no-conversation">
                    <h3>ðŸ‘‹ Hi, {{ request.user.get_username }}</h3>
                    <p>Select a connection from the list to start chatting.</p>
                    {% if connected_users %}
                        <p style="color: var(--msg-text-secondary); font-size: 14px;">Click on a user from the left panel to begin messaging.</p>
                    {% else %}
                        <p style="color: var(--msg-text-secondary); font-size: 14px;">
                            You need connections to message. <a href="{% url 'connections' %}">Add connections</a> first.
                        </p>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>
{% else %}
    <div class="card">
        <p>You're not signed in.</p>
        <div class="actions">
            <a class="btn btn-primary" href="{% url 'signin' %}">Sign in</a>
            <a class="btn" href="{% url 'signup' %}">Create account</a>
        </div>
    </div>
{% endif %}
{% endblock %}